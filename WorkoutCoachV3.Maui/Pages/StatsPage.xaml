<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WorkoutCoachV3.Maui.Pages.StatsPage"
             x:Name="PageRoot"
             Title="Stats">

    <Grid RowDefinitions="Auto,*" Padding="16" RowSpacing="12">

        <Grid Grid.Row="0" ColumnDefinitions="Auto,*" ColumnSpacing="12">
            <Label Text="Stats"
                   FontSize="{OnIdiom Phone=20, Default=28}"
                   VerticalOptions="Center" />

            <ScrollView Grid.Column="1"
                        Orientation="Horizontal"
                        HorizontalScrollBarVisibility="Never">
                <HorizontalStackLayout Spacing="8">
                    <Button Text="Exercises" Command="{Binding GoToExercisesCommand}" />
                    <Button Text="Workouts"  Command="{Binding GoToWorkoutsCommand}" />
                    <Button Text="Sessions"  Command="{Binding GoToSessionsCommand}" />
                    <Button Text="Stats" IsEnabled="False" />

                    <Button Text="Admin"
                            Command="{Binding GoToAdminCommand}"
                            IsVisible="{Binding CanAccessAdmin}" />

                    <Button Text="Add" Command="{Binding AddCommand}" />
                    <Button Text="Logout" Command="{Binding LogoutCommand}" />
                </HorizontalStackLayout>
            </ScrollView>
        </Grid>

        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}">

            <ScrollView>
                <VerticalStackLayout Spacing="16">

                    <Grid ColumnDefinitions="{OnIdiom Phone='*,*', Default='2*,*,*,Auto'}"
                          RowDefinitions="{OnIdiom Phone='Auto,Auto,Auto', Default='Auto'}"
                          ColumnSpacing="12"
                          RowSpacing="10">

                        <VerticalStackLayout
                            Grid.Row="{OnIdiom Phone=0, Default=0}"
                            Grid.Column="{OnIdiom Phone=0, Default=0}"
                            Grid.ColumnSpan="{OnIdiom Phone=2, Default=1}"
                            Spacing="6">
                            <Label Text="Exercise" />
                            <Picker ItemsSource="{Binding ExerciseOptions}"
                                    SelectedItem="{Binding SelectedExercise}" />
                        </VerticalStackLayout>

                        <VerticalStackLayout
                            Grid.Row="{OnIdiom Phone=1, Default=0}"
                            Grid.Column="{OnIdiom Phone=0, Default=1}"
                            Spacing="6">
                            <Label Text="From" />
                            <DatePicker Date="{Binding FromDate}" />
                        </VerticalStackLayout>

                        <VerticalStackLayout
                            Grid.Row="{OnIdiom Phone=1, Default=0}"
                            Grid.Column="{OnIdiom Phone=1, Default=2}"
                            Spacing="6">
                            <Label Text="To" />
                            <DatePicker Date="{Binding ToDate}" />
                        </VerticalStackLayout>

                        <Button
                            Grid.Row="{OnIdiom Phone=2, Default=0}"
                            Grid.Column="{OnIdiom Phone=0, Default=3}"
                            Grid.ColumnSpan="{OnIdiom Phone=2, Default=1}"
                            Text="Apply"
                            Command="{Binding ApplyCommand}" />
                    </Grid>

                    <Button Text="Reload"
                            Command="{Binding LoadCommand}"
                            HorizontalOptions="Start" />

                    <Label Text="Overall stats" FontAttributes="Bold" FontSize="18" />

                    <!-- Overall stats: desktop 4 kolommen / phone 2x2 -->
                    <Grid ColumnDefinitions="{OnIdiom Phone='*,*', Default='*,*,*,*'}"
                          RowDefinitions="{OnIdiom Phone='Auto,Auto', Default='Auto'}"
                          ColumnSpacing="12"
                          RowSpacing="12">

                        <Frame Grid.Row="{OnIdiom Phone=0, Default=0}" Grid.Column="{OnIdiom Phone=0, Default=0}"
                               Padding="12" CornerRadius="12" HasShadow="False"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                               BorderColor="{AppThemeBinding Light=#DDDDDD, Dark=#333333}">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Sessions" Opacity="0.7"/>
                                <Label Text="{Binding SessionsCount}" FontAttributes="Bold" FontSize="18"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Grid.Row="{OnIdiom Phone=0, Default=0}" Grid.Column="{OnIdiom Phone=1, Default=1}"
                               Padding="12" CornerRadius="12" HasShadow="False"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                               BorderColor="{AppThemeBinding Light=#DDDDDD, Dark=#333333}">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Sets" Opacity="0.7"/>
                                <Label Text="{Binding SetsCount}" FontAttributes="Bold" FontSize="18"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Grid.Row="{OnIdiom Phone=1, Default=0}" Grid.Column="{OnIdiom Phone=0, Default=2}"
                               Padding="12" CornerRadius="12" HasShadow="False"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                               BorderColor="{AppThemeBinding Light=#DDDDDD, Dark=#333333}">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Total reps" Opacity="0.7"/>
                                <Label Text="{Binding TotalReps}" FontAttributes="Bold" FontSize="18"/>
                            </VerticalStackLayout>
                        </Frame>

                        <Frame Grid.Row="{OnIdiom Phone=1, Default=0}" Grid.Column="{OnIdiom Phone=1, Default=3}"
                               Padding="12" CornerRadius="12" HasShadow="False"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                               BorderColor="{AppThemeBinding Light=#DDDDDD, Dark=#333333}">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Total volume (kg)" Opacity="0.7"/>
                                <Label Text="{Binding TotalVolumeKg, StringFormat='{0:0.##}'}"
                                       FontAttributes="Bold"
                                       FontSize="18"/>
                            </VerticalStackLayout>
                        </Frame>

                    </Grid>

                    <Label Text="Top exercises (by volume)" FontAttributes="Bold" FontSize="18" />

                    <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Always">
                        <VerticalStackLayout Spacing="6" MinimumWidthRequest="{OnIdiom Phone=520, Default=0}">

                            <Grid ColumnDefinitions="200,60,60,100,80" ColumnSpacing="10">
                                <Label Text="Exercise" FontAttributes="Bold"/>
                                <Label Grid.Column="1" Text="Sets" FontAttributes="Bold" HorizontalTextAlignment="End"/>
                                <Label Grid.Column="2" Text="Reps" FontAttributes="Bold" HorizontalTextAlignment="End"/>
                                <Label Grid.Column="3" Text="Volume (kg)" FontAttributes="Bold" HorizontalTextAlignment="End"/>
                                <Label Grid.Column="4" Text="Max (kg)" FontAttributes="Bold" HorizontalTextAlignment="End"/>
                            </Grid>

                            <VerticalStackLayout BindableLayout.ItemsSource="{Binding TopExercises}">
                                <BindableLayout.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="200,60,60,100,80" ColumnSpacing="10" Padding="0,8">
                                            <Label Text="{Binding ExerciseName}" LineBreakMode="TailTruncation"/>
                                            <Label Grid.Column="1" Text="{Binding Sets}" HorizontalTextAlignment="End" />
                                            <Label Grid.Column="2" Text="{Binding Reps}" HorizontalTextAlignment="End" />
                                            <Label Grid.Column="3" Text="{Binding VolumeKg, StringFormat='{0:0.##}'}" HorizontalTextAlignment="End" />
                                            <Label Grid.Column="4" Text="{Binding MaxKg, StringFormat='{0:0.##}'}" HorizontalTextAlignment="End" />
                                        </Grid>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </VerticalStackLayout>

                        </VerticalStackLayout>
                    </ScrollView>

                    <ActivityIndicator IsRunning="{Binding IsBusy}"
                                       IsVisible="{Binding IsBusy}"
                                       HorizontalOptions="Center" />

                    <Label Text="{Binding Error}" TextColor="Red" />
                </VerticalStackLayout>
            </ScrollView>

        </RefreshView>

    </Grid>
</ContentPage>
