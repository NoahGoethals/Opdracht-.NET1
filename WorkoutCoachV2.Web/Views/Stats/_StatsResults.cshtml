@model WorkoutCoachV2.Web.Models.StatsResultsViewModel  // Dit is het "resultaatmodel" met alle statistieken

@using Microsoft.Extensions.Localization
@using WorkoutCoachV2.Web
@inject IStringLocalizer<SharedResource> L              // Vertalingen (labels/teksten)

@{
    // Tekst die het datumbereik toont (van → tot). Leeg als er geen filter is.
    string rangeText = "";
    if (Model.From.HasValue || Model.To.HasValue)
    {
        var from = Model.From?.ToString("yyyy-MM-dd") ?? "..."; // Als geen from: "..."
        var to = Model.To?.ToString("yyyy-MM-dd") ?? "...";     // Als geen to: "..."
        rangeText = $"{from} → {to}";
    }
}

@if (!string.IsNullOrWhiteSpace(rangeText))
{
    <!-- Toon het datumbereik enkel als het bestaat -->
    <div class="mb-2 text-muted">
        @L["St_Range"]: <strong>@rangeText</strong>
    </div>
}

@if (Model.ExerciseId.HasValue)
{
    // CASE 1: er is een specifieke oefening gekozen → toon detail stats per sessie
    <h5>@L["St_Exercise"]: @(!string.IsNullOrWhiteSpace(Model.ExerciseName) ? Model.ExerciseName : $"#{Model.ExerciseId}")</h5>

    <!-- Kleine "cards" met kerncijfers -->
    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_Sessions"]</div>
                <div class="fw-bold">@Model.SessionsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_Sets"]</div>
                <div class="fw-bold">@Model.SetsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_TotalReps"]</div>
                <div class="fw-bold">@Model.TotalReps</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_TotalVolumeKg"]</div>
                <div class="fw-bold">@Model.TotalVolumeKg.ToString("0.##")</div> <!-- afronden -->
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_MaxWeightKg"]</div>
                <div class="fw-bold">@Model.MaxWeight.ToString("0.##")</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_BestEstimated1Rm"]</div>
                <div class="fw-bold">@Model.BestEstimated1Rm.ToString("0.##")</div>
            </div>
        </div>
    </div>

    @if (Model.PerSession.Count == 0)
    {
        <!-- Geen sets gevonden met deze filters -->
        <div class="alert alert-warning">@L["St_NoSetsForFilter"]</div>
    }
    else
    {
        <!-- Tabel: per sessie (datum/title) hoeveel sets/reps/volume/max -->
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>@L["St_Col_Date"]</th>
                    <th>@L["St_Col_Session"]</th>
                    <th class="text-end">@L["St_Col_Sets"]</th>
                    <th class="text-end">@L["St_Col_Reps"]</th>
                    <th class="text-end">@L["St_Col_VolumeKg"]</th>
                    <th class="text-end">@L["St_Col_MaxKg"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.PerSession)
                {
                    <tr>
                        <td>@row.Date.ToShortDateString()</td>               <!-- datum -->
                        <td>@row.SessionTitle</td>                           <!-- sessienaam -->
                        <td class="text-end">@row.SetsCount</td>
                        <td class="text-end">@row.TotalReps</td>
                        <td class="text-end">@row.TotalVolumeKg.ToString("0.##")</td>
                        <td class="text-end">@row.MaxWeight.ToString("0.##")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
else
{
    // CASE 2: geen oefening gekozen → toon algemene stats + top oefeningen
    <h5>@L["St_Overall_Title"]</h5>

    <!-- Algemene kerncijfers -->
    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_Sessions"]</div>
                <div class="fw-bold">@Model.SessionsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_Sets"]</div>
                <div class="fw-bold">@Model.SetsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_TotalReps"]</div>
                <div class="fw-bold">@Model.TotalReps</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">@L["St_Card_TotalVolumeKg"]</div>
                <div class="fw-bold">@Model.TotalVolumeKg.ToString("0.##")</div>
            </div>
        </div>
    </div>

    @if (Model.TopExercises.Count == 0)
    {
        <!-- Geen data gevonden voor deze filters -->
        <div class="alert alert-warning">@L["St_NoDataForFilter"]</div>
    }
    else
    {
        <h6 class="mt-3">@L["St_TopExercisesByVolume"]</h6>

        <!-- Tabel: top 10 oefeningen op volume -->
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>@L["St_Col_Exercise"]</th>
                    <th class="text-end">@L["St_Col_Sets"]</th>
                    <th class="text-end">@L["St_Col_Reps"]</th>
                    <th class="text-end">@L["St_Col_VolumeKg"]</th>
                    <th class="text-end">@L["St_Col_MaxKg"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.TopExercises)
                {
                    <tr>
                        <td>
                            <!-- Klik op oefening = open Stats/Index met exerciseId filter -->
                            <a asp-controller="Stats" asp-action="Index" asp-route-exerciseId="@row.ExerciseId">
                                @row.ExerciseName
                            </a>
                        </td>
                        <td class="text-end">@row.SetsCount</td>
                        <td class="text-end">@row.TotalReps</td>
                        <td class="text-end">@row.TotalVolumeKg.ToString("0.##")</td>
                        <td class="text-end">@row.MaxWeight.ToString("0.##")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
