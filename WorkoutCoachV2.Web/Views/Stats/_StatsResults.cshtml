@model WorkoutCoachV2.Web.Models.StatsResultsViewModel

@{
    string rangeText = "";
    if (Model.From.HasValue || Model.To.HasValue)
    {
        var from = Model.From?.ToString("yyyy-MM-dd") ?? "...";
        var to = Model.To?.ToString("yyyy-MM-dd") ?? "...";
        rangeText = $"{from} → {to}";
    }
}

@if (!string.IsNullOrWhiteSpace(rangeText))
{
    <div class="mb-2 text-muted">
        Range: <strong>@rangeText</strong>
    </div>
}

@if (Model.ExerciseId.HasValue)
{
    <h5>Exercise: @(!string.IsNullOrWhiteSpace(Model.ExerciseName) ? Model.ExerciseName : $"#{Model.ExerciseId}")</h5>

    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Sessions</div>
                <div class="fw-bold">@Model.SessionsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Sets</div>
                <div class="fw-bold">@Model.SetsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Total reps</div>
                <div class="fw-bold">@Model.TotalReps</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Total volume (kg)</div>
                <div class="fw-bold">@Model.TotalVolumeKg.ToString("0.##")</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Max weight (kg)</div>
                <div class="fw-bold">@Model.MaxWeight.ToString("0.##")</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Best est. 1RM</div>
                <div class="fw-bold">@Model.BestEstimated1Rm.ToString("0.##")</div>
            </div>
        </div>
    </div>

    @if (Model.PerSession.Count == 0)
    {
        <div class="alert alert-warning">No sets found for this filter.</div>
    }
    else
    {
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Session</th>
                    <th class="text-end">Sets</th>
                    <th class="text-end">Reps</th>
                    <th class="text-end">Volume (kg)</th>
                    <th class="text-end">Max (kg)</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.PerSession)
                {
                    <tr>
                        <td>@row.Date.ToShortDateString()</td>
                        <td>@row.SessionTitle</td>
                        <td class="text-end">@row.SetsCount</td>
                        <td class="text-end">@row.TotalReps</td>
                        <td class="text-end">@row.TotalVolumeKg.ToString("0.##")</td>
                        <td class="text-end">@row.MaxWeight.ToString("0.##")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
else
{
    <h5>Overall stats (all exercises)</h5>

    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Sessions</div>
                <div class="fw-bold">@Model.SessionsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Sets</div>
                <div class="fw-bold">@Model.SetsCount</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Total reps</div>
                <div class="fw-bold">@Model.TotalReps</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="border rounded p-2">
                <div class="text-muted small">Total volume (kg)</div>
                <div class="fw-bold">@Model.TotalVolumeKg.ToString("0.##")</div>
            </div>
        </div>
    </div>

    @if (Model.TopExercises.Count == 0)
    {
        <div class="alert alert-warning">No data found for this filter.</div>
    }
    else
    {
        <h6 class="mt-3">Top exercises (by volume)</h6>

        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Exercise</th>
                    <th class="text-end">Sets</th>
                    <th class="text-end">Reps</th>
                    <th class="text-end">Volume (kg)</th>
                    <th class="text-end">Max (kg)</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.TopExercises)
                {
                    <tr>
                        <td>
                            <a asp-controller="Stats" asp-action="Index" asp-route-exerciseId="@row.ExerciseId">
                                @row.ExerciseName
                            </a>
                        </td>
                        <td class="text-end">@row.SetsCount</td>
                        <td class="text-end">@row.TotalReps</td>
                        <td class="text-end">@row.TotalVolumeKg.ToString("0.##")</td>
                        <td class="text-end">@row.MaxWeight.ToString("0.##")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
